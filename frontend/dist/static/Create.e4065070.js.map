{"version":3,"file":"Create.e4065070.js","sources":["../../src/components/Create.vue"],"sourcesContent":["<template>\n  <div class=\"container mt-5 rt-wp mb-5\">\n    <h1 class=\"fs-2 fw-bold mb-4\">Добавление мероприятия</h1>\n\n    <div class=\"mb-3\">\n      <FormInput\n        label=\"Название\"\n        v-model=\"data.name.value\"\n        :error=\"data.name.errorMessage\"\n        :isBound=\"isBound\"\n        :maxlength=\"100\"\n        name=\"name\"\n      ></FormInput>\n    </div>\n\n    <div class=\"mb-3\">\n      <label for=\"desc_id\" class=\"form-label\">Описание</label>\n      <textarea\n        name=\"desc\"\n        id=\"desc_id\"\n        cols=\"30\"\n        rows=\"10\"\n        class=\"form-control\"\n        v-model=\"data.description.value\"\n      ></textarea>\n    </div>\n\n    <div class=\"mb-3\">\n      <div class=\"mb-2\">Начало мероприятия</div>\n      <datepicker\n        v-model=\"start_date\"\n        :position=\"'left'\"\n        locale=\"ru\"\n        class=\"w-100 mb-2\"\n        :select-text=\"'Выбрать'\"\n        :cancel-text=\"'Отмена'\"\n        :clearable=\"false\"\n      />\n    </div>\n\n    <div class=\"mb-3\">\n      <div class=\"mb-2\">Конец мероприятия</div>\n      <datepicker\n        v-model=\"end_date\"\n        :position=\"'left'\"\n        locale=\"ru\"\n        class=\"w-100 mb-2\"\n        :select-text=\"'Выбрать'\"\n        :cancel-text=\"'Отмена'\"\n        :clearable=\"false\"\n      />\n    </div>\n\n    <div class=\"mb-3\">\n      <FormInput\n        label=\"Цена\"\n        v-model=\"data.price.value\"\n        :error=\"data.price.errorMessage\"\n        :isBound=\"isBound\"\n        name=\"price\"\n        type=\"number\"\n      ></FormInput>\n    </div>\n\n    <div class=\"mb-3\">\n      <FormInput\n        label=\"Максимальная цена\"\n        v-model=\"data.max_price.value\"\n        :error=\"data.max_price.errorMessage\"\n        :isBound=\"isBound\"\n        name=\"max_price\"\n        type=\"number\"\n      ></FormInput>\n    </div>\n\n    <div class=\"mb-3\">\n      <FormInput\n        label=\"Количество участников\"\n        v-model=\"data.participants.value\"\n        :error=\"data.participants.errorMessage\"\n        :isBound=\"isBound\"\n        name=\"\"\n        type=\"number\"\n      ></FormInput>\n    </div>\n\n    <div class=\"mb-3\">\n      <FormInput\n        label=\"Адрес\"\n        v-model=\"data.address.value\"\n        :error=\"data.address.errorMessage\"\n        :isBound=\"isBound\"\n        name=\"address\"\n      ></FormInput>\n    </div>\n\n    <div class=\"mb-3\">\n      <div class=\"form-check\">\n        <input\n          class=\"form-check-input\"\n          type=\"checkbox\"\n          v-model=\"reg_needed\"\n          id=\"reg_needed\"\n        />\n        <label class=\"form-check-label\" for=\"reg_needed\">\n          Требуется регистрация\n        </label>\n      </div>\n    </div>\n    <!-- \n    <div class=\"mb-3\">\n      <FormInput\n        label=\"Обложка\"\n        v-model=\"data.thumbnail.value\"\n        :error=\"data.thumbnail.errorMessage\"\n        :isBound=\"isBound\"\n        name=\"thumbnail\"\n        type=\"file\"\n      ></FormInput>\n    </div> -->\n\n    <button class=\"btn btn-outline-dark\" @click=\"submit\">Добавить</button>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { createEvent, CreateEventData } from \"@/api/services/events\";\nimport { reactive, ref } from \"vue\";\nimport { FormInput } from \"@/components\";\nimport { FormBuilder, validateForm } from \"@/utils/forms\";\nimport { useStore } from \"@/store\";\nimport moment from \"moment\";\nimport Datepicker from \"@vuepic/vue-datepicker\";\nimport \"@vuepic/vue-datepicker/dist/main.css\";\nimport { useRouter } from \"vue-router\";\n\nconst isBound = ref(false);\nconst store = useStore();\nconst router = useRouter();\n\nconst start_date = ref(moment().add(1, \"day\").toDate());\nconst end_date = ref(moment().add(1, \"day\").add(1, \"hour\").toDate());\nconst reg_needed = ref(false);\n\nconst data = reactive<FormBuilder>({\n  name: {\n    validators: [\"required\"],\n    value: \"\",\n  },\n  price: {\n    validators: [\"required\"],\n    value: \"0\",\n  },\n  description: {\n    value: \"\",\n    validators: [],\n  },\n  max_price: {\n    validators: [],\n    value: \"0\",\n  },\n  participants: {\n    validators: [\"required\"],\n    value: \"1\",\n  },\n  address: {\n    validators: [],\n    value: \"\",\n  },\n  // thumbnail: {\n  //   validators: [],\n  //   value: \"\",\n  // },\n});\n\nconst submit = () => {\n  const verdict = validateForm(data);\n  if (!isBound.value) isBound.value = true;\n  if (!verdict) return;\n\n  const newEvent: CreateEventData = {\n    creator: store.state.auth.user?.id as number,\n    price: parseInt(data.price.value),\n    max_price: parseInt(data.max_price.value),\n    participants: parseInt(data.participants.value),\n    address: data.address.value,\n    reg_needed: reg_needed.value,\n    start: start_date.value.toISOString(),\n    end: start_date.value.toISOString(),\n    description: data.description.value,\n    name: data.name.value,\n  };\n\n  // if (data.thumbnail.value) {\n  //   newEvent.thumbnail = data.thumbnail.value;\n  // }\n\n  createEvent(newEvent).then(() => {\n    router.push(\"/\");\n  });\n  // .catch((e: AxiosError) => {\n  //   handleBackendError(e, {\n  //     \"400\": {\n  //       username: () => {\n  //         data.username.errorMessage = \"Имя пользователя уже занято\";\n  //       },\n  //     },\n  //   });\n  // });\n};\n</script>\n"],"names":["isBound","ref","store","useStore","router","useRouter","start_date","moment","end_date","reg_needed","data","reactive","submit","verdict","validateForm","newEvent","_a","createEvent"],"mappings":"6oCAwIM,MAAAA,EAAUC,EAAI,EAAK,EACnBC,EAAQC,IACRC,EAASC,IAETC,EAAaL,EAAIM,IAAS,IAAI,EAAG,KAAK,EAAE,OAAA,CAAQ,EAChDC,EAAWP,EAAIM,EAAO,EAAE,IAAI,EAAG,KAAK,EAAE,IAAI,EAAG,MAAM,EAAE,OAAQ,CAAA,EAC7DE,EAAaR,EAAI,EAAK,EAEtBS,EAAOC,EAAsB,CACjC,KAAM,CACJ,WAAY,CAAC,UAAU,EACvB,MAAO,EACT,EACA,MAAO,CACL,WAAY,CAAC,UAAU,EACvB,MAAO,GACT,EACA,YAAa,CACX,MAAO,GACP,WAAY,CAAC,CACf,EACA,UAAW,CACT,WAAY,CAAC,EACb,MAAO,GACT,EACA,aAAc,CACZ,WAAY,CAAC,UAAU,EACvB,MAAO,GACT,EACA,QAAS,CACP,WAAY,CAAC,EACb,MAAO,EACT,CAAA,CAKD,EAEKC,EAAS,IAAM,OACb,MAAAC,EAAUC,EAAaJ,CAAI,EAEjC,GADKV,EAAQ,QAAOA,EAAQ,MAAQ,IAChC,CAACa,EAAS,OAEd,MAAME,EAA4B,CAChC,SAASC,EAAAd,EAAM,MAAM,KAAK,OAAjB,YAAAc,EAAuB,GAChC,MAAO,SAASN,EAAK,MAAM,KAAK,EAChC,UAAW,SAASA,EAAK,UAAU,KAAK,EACxC,aAAc,SAASA,EAAK,aAAa,KAAK,EAC9C,QAASA,EAAK,QAAQ,MACtB,WAAYD,EAAW,MACvB,MAAOH,EAAW,MAAM,YAAY,EACpC,IAAKA,EAAW,MAAM,YAAY,EAClC,YAAaI,EAAK,YAAY,MAC9B,KAAMA,EAAK,KAAK,KAAA,EAONO,EAAAF,CAAQ,EAAE,KAAK,IAAM,CAC/BX,EAAO,KAAK,GAAG,CAAA,CAChB,CAAA"}