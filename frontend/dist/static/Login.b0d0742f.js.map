{"version":3,"file":"Login.b0d0742f.js","sources":["../../src/components/Login.vue"],"sourcesContent":["<template>\n  <div class=\"container mt-4 rt-wp\">\n    <div class=\"row justify-content-sm-center\">\n      <div class=\"col col-md-9 col-lg-6\">\n        <div class=\"card card-body login my-3\">\n          <h2 class=\"card-title text-center\">Вход</h2>\n\n          <form @submit.prevent=\"processLogin\">\n            <div class=\"mb-3\">\n              <form-input\n                type=\"text\"\n                name=\"username\"\n                label=\"Имя пользователя\"\n                v-model=\"credentials.username.value\"\n                :error=\"credentials.username.errorMessage\"\n                :isBound=\"credentials.username.isBound\"\n              />\n            </div>\n            <div class=\"mb-3\">\n              <form-input\n                name=\"password\"\n                label=\"Пароль\"\n                v-model=\"credentials.password.value\"\n                password\n                :error=\"credentials.password.errorMessage\"\n                :isBound=\"credentials.password.isBound\"\n              />\n            </div>\n\n            <div>\n              <button type=\"submit\" class=\"btn btn-outline-dark w-100\">\n                Войти\n              </button>\n            </div>\n\n            <div class=\"text-center mt-3\">\n              <div>\n                Ещё не зарегистрировались?\n                <router-link to=\"/register\"> Создайте аккаунт</router-link>\n              </div>\n              <div class=\"mt-2\">\n                <a href=\"{% url 'reset_password' %}\">Забыли пароль?</a>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { FormBuilder, validateForm, Validator } from \"@/utils/forms\";\nimport { ref } from \"vue\";\nimport { AxiosError } from \"axios\";\nimport router from \"@/router\";\nimport { FormInput } from \"@/components\";\nimport { useStore } from \"@/store\";\nimport { AuthActionTypes, UserCredentials } from \"@/store/modules/auth/types\";\n\nconst authError = ref<AxiosError | null>(null);\nconst store = useStore();\n\nconst authChecker: Validator = {\n  check: () => {\n    return authError.value === null;\n  },\n  errorMessage: \"Неверный логин или пароль\",\n};\n\nconst credentials = ref<FormBuilder>({\n  username: {\n    value: \"\",\n    validators: [\"required\"],\n    checkers: {\n      authChecker,\n    },\n    isBound: false,\n  },\n  password: {\n    value: \"\",\n    validators: [\"required\"],\n  },\n});\n\nconst processLogin = (): void => {\n  authError.value = null;\n  const verdict = validateForm(credentials.value);\n\n  if (!verdict) {\n    return;\n  }\n\n  const data: UserCredentials = {\n    username: credentials.value.username.value,\n    password: credentials.value.password.value,\n  };\n\n  store\n    .dispatch(AuthActionTypes.LOGIN, data)\n    .then(() => {\n      store.dispatch(AuthActionTypes.FETCH_CURRENT_USER).then(() => {\n        router.push(\"/\");\n      });\n    })\n    .catch((error: AxiosError) => {\n      if (error.response?.status === 401) {\n        authError.value = error;\n        validateForm(credentials.value);\n        if (\n          authError.value !== null &&\n          !credentials.value.password.errorMessage\n        ) {\n          credentials.value.password.isBound = false;\n        }\n      }\n    });\n};\n</script>\n\n<style></style>\n"],"names":["authError","ref","store","useStore","credentials","processLogin","validateForm","data","AuthActionTypes","router","error","_a"],"mappings":"mgCA4DM,MAAAA,EAAYC,EAAuB,IAAI,EACvCC,EAAQC,IASRC,EAAcH,EAAiB,CACnC,SAAU,CACR,MAAO,GACP,WAAY,CAAC,UAAU,EACvB,SAAU,CACR,YAZyB,CAC7B,MAAO,IACED,EAAU,QAAU,KAE7B,aAAc,yIAAA,CASZ,EACA,QAAS,EACX,EACA,SAAU,CACR,MAAO,GACP,WAAY,CAAC,UAAU,CACzB,CAAA,CACD,EAEKK,EAAe,IAAY,CAI/B,GAHAL,EAAU,MAAQ,KAGd,CAFYM,EAAaF,EAAY,KAAK,EAG5C,OAGF,MAAMG,EAAwB,CAC5B,SAAUH,EAAY,MAAM,SAAS,MACrC,SAAUA,EAAY,MAAM,SAAS,KAAA,EAGvCF,EACG,SAASM,EAAgB,MAAOD,CAAI,EACpC,KAAK,IAAM,CACVL,EAAM,SAASM,EAAgB,kBAAkB,EAAE,KAAK,IAAM,CAC5DC,EAAO,KAAK,GAAG,CAAA,CAChB,CAAA,CACF,EACA,MAAOC,GAAsB,SACxBC,EAAAD,EAAM,WAAN,YAAAC,EAAgB,UAAW,MAC7BX,EAAU,MAAQU,EAClBJ,EAAaF,EAAY,KAAK,EAE5BJ,EAAU,QAAU,MACpB,CAACI,EAAY,MAAM,SAAS,eAEhBA,EAAA,MAAM,SAAS,QAAU,IAEzC,CACD,CAAA"}