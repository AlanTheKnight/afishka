{"version":3,"file":"EventInfo.b523c9be.js","sources":["../../src/utils/translation.ts","../../src/components/EventInfo.vue"],"sourcesContent":["/**\n * Pluralization rules for Russian language.\n * @param n Quantity\n * @param x Array of strings with Russian translations\n * @param showNum Whether to show the quantity\n * @returns Russian translation\n */\nexport const plural = (n: number, x: string[], showNum = false): string => {\n  let p = 2;\n  if (n % 10 === 1 && n % 100 === 1) p = 0;\n  else if (2 <= n % 10 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20)) p = 1;\n  return (showNum ? String(n) + \" \" : \"\") + x[p];\n};\n\nexport default {\n  plural,\n};\n","<template>\n  <Loading :is-loading=\"isLoading\">\n    <div v-if=\"obj\" class=\"container rt-wp mt-4\">\n      <div class=\"alert alert-warning\" v-if=\"!obj.accepted\">\n        <i class=\"bi-exclamation-circle me-2\"></i>Данное событие ожидает\n        подтверждения модератора\n      </div>\n      <div\n        class=\"card\"\n        :style=\"\n          obj.thumbnail\n            ? `background-image: url(${obj.thumbnail}); background-size: cover; background-repeat: no-repeat; background-position: center center;`\n            : gradients[obj.id % gradients.length][0]\n        \"\n      >\n        <div\n          class=\"card-body position-relative d-flex align-items-center justify-content-center\"\n          :class=\"\n            obj.thumbnail\n              ? ['text-light']\n              : [gradients[obj.id % gradients.length][1]]\n          \"\n        >\n          <h1\n            class=\"card-name fw-bold fs-2\"\n            :class=\"obj.thumbnail ? ['badge bg-white text-dark'] : []\"\n          >\n            {{ obj.name }}\n          </h1>\n\n          <div\n            class=\"position-absolute top-0 end-0 pt-3 pe-3\"\n            v-if=\"store.getters.isAuthenticated\"\n          >\n            <div id=\"star-btn\" @click=\"changeStarredState\">\n              <svg\n                v-if=\"!isStarred\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                width=\"16\"\n                height=\"16\"\n                fill=\"currentColor\"\n                class=\"bi bi-star icon\"\n                viewBox=\"0 0 16 16\"\n              >\n                <path\n                  d=\"M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z\"\n                />\n              </svg>\n              <svg\n                v-else\n                xmlns=\"http://www.w3.org/2000/svg\"\n                width=\"16\"\n                height=\"16\"\n                fill=\"currentColor\"\n                class=\"bi bi-star-fill icon\"\n                viewBox=\"0 0 16 16\"\n              >\n                <path\n                  d=\"M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z\"\n                />\n              </svg>\n            </div>\n          </div>\n\n          <div\n            class=\"position-absolute bottom-0 start-0 mb-2 ms-2 badge bg-light text-dark fs-5\"\n          >\n            <div v-if=\"obj.price > 0\">\n              <span>{{ obj.price }}</span>\n              <span v-if=\"obj.max_price && obj.max_price > obj.price\">\n                - {{ obj.max_price }}</span\n              >&#8381;\n            </div>\n            <div v-else>бесплатно</div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"row mt-3\">\n        <div class=\"col order-1 order-md-0 fs-5\">\n          <div class=\"\">\n            <div class=\"mb-3\" v-if=\"obj.description\">\n              {{ obj.description }}\n            </div>\n            <div class=\"mb-1\">\n              <i class=\"bi bi-clock me-2\"></i>\n              {{ toShortDateTime(new Date(obj.start)) }}\n            </div>\n            <div v-if=\"obj.address\" class=\"mb-1\">\n              <i class=\"bi-geo-alt me-2\"></i>{{ obj.address }}\n            </div>\n            <div class=\"mb-1\">\n              <i class=\"bi bi-check me-2\"></i\n              >{{\n                obj.reg_needed\n                  ? \"Требуется регистрация\"\n                  : \"Регистрация не требуется\"\n              }}\n            </div>\n            <div v-if=\"obj.organizer\" class=\"mb-1\">\n              <i class=\"bi-person me-2\"></i>\n              {{ obj.organizer }}\n            </div>\n            <div v-if=\"obj.organizer\" class=\"mb-1\">\n              <i class=\"bi-people me-2\"></i>\n              {{\n                plural(\n                  obj.participants,\n                  [\"участник\", \"участника\", \"участников\"],\n                  true\n                )\n              }}\n            </div>\n          </div>\n        </div>\n        <div\n          class=\"col-12 col-md-auto order-0 order-md-1 mb-2 mb-md-0\"\n          v-if=\"store.state.auth.user?.is_staff\"\n        >\n          <div class=\"mb-2\">\n            <button\n              class=\"btn btn-outline-danger w-100\"\n              @click=\"\n                () => deleteEvent(String(obj?.id)).then(() => router.push('/'))\n              \"\n            >\n              <i class=\"bi-trash me-2\"></i>Удалить\n            </button>\n          </div>\n\n          <div class=\"mb-2\">\n            <a\n              class=\"btn btn-outline-dark w-100\"\n              :href=\"`/admin/core/event/${obj.id}/change/`\"\n            >\n              <i class=\"bi-pencil me-2\"></i>Изменить\n            </a>\n          </div>\n          <div class=\"mb-2\">\n            <button\n              v-if=\"!obj.accepted\"\n              class=\"btn btn-outline-dark w-100\"\n              @click=\"markAsAccepted\"\n            >\n              <i class=\"bi-check-lg me-2\"></i>Опубликовать\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Loading>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, ref } from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport {\n  getEvent,\n  APIEvent,\n  starEvent,\n  deleteEvent,\n  patchEvent,\n} from \"@/api/services/events\";\nimport { useStore } from \"@/store\";\nimport { AuthActionTypes } from \"@/store/modules/auth/types\";\nimport { computed } from \"vue\";\nimport gradients from \"./gradients\";\nimport { Loading } from \".\";\nimport { plural } from \"@/utils/translation\";\n\nconst route = useRoute();\nconst router = useRouter();\n\nconst isLoading = ref(true);\n\nconst obj = ref<APIEvent | null>(null);\n\nconst refresh = () => {\n  const id = route.params.id;\n  getEvent(id as string)\n    .then((resp) => {\n      obj.value = resp.data;\n      isLoading.value = false;\n    })\n    .catch(() => router.push(\"/\"));\n};\n\nonMounted(refresh);\n\nconst store = useStore();\nconst isStarred = computed(\n  () =>\n    store.state.auth.user &&\n    obj.value &&\n    store.state.auth.user.starred_events.includes(obj.value.id)\n);\n\nconst changeStarredState = () => {\n  if (!obj.value) return;\n  starEvent(obj.value.id, !isStarred.value).then(() => {\n    store.dispatch(AuthActionTypes.FETCH_CURRENT_USER);\n  });\n};\n\nconst markAsAccepted = () => {\n  if (!obj.value) return;\n  patchEvent(obj.value.id, { accepted: true }).then(refresh);\n};\n\nconst toShortDateTime = (date: Date): string => {\n  return date.toLocaleDateString(\"ru\", {\n    day: \"numeric\",\n    month: \"long\",\n    hour: \"numeric\",\n    minute: \"numeric\",\n  });\n};\n</script>\n\n<style scoped>\n.card {\n  background-color: #4158d0;\n  background-image: linear-gradient(\n    43deg,\n    #4158d0 0%,\n    #c850c0 46%,\n    #ffcc70 100%\n  );\n  border: 0;\n  min-height: 200px;\n}\n\n#star-btn:hover {\n  transform: scale(1.1);\n}\n\n#star-btn {\n  transition: all 0.2s ease-in-out;\n}\n\n.icon {\n  width: 24px;\n  height: 24px;\n}\n</style>\n"],"names":["plural","n","x","showNum","p","route","useRoute","router","useRouter","isLoading","ref","obj","refresh","id","getEvent","resp","onMounted","store","useStore","isStarred","computed","changeStarredState","starEvent","AuthActionTypes","markAsAccepted","patchEvent","toShortDateTime","date"],"mappings":"qOAOO,MAAMA,EAAS,CAACC,EAAWC,EAAaC,EAAU,KAAkB,CACzE,IAAIC,EAAI,EACR,OAAIH,EAAI,KAAO,GAAKA,EAAI,MAAQ,EAAOG,EAAA,EAC9B,GAAKH,EAAI,IAAMA,EAAI,IAAM,IAAMA,EAAI,IAAM,IAAMA,EAAI,KAAO,MAASG,EAAA,IACpED,EAAU,OAAOF,CAAC,EAAI,IAAM,IAAMC,EAAEE,EAC9C,ssFC8JA,MAAMC,EAAQC,IACRC,EAASC,IAETC,EAAYC,EAAI,EAAI,EAEpBC,EAAMD,EAAqB,IAAI,EAE/BE,EAAU,IAAM,CACd,MAAAC,EAAKR,EAAM,OAAO,GACxBS,EAASD,CAAY,EAClB,KAAME,GAAS,CACdJ,EAAI,MAAQI,EAAK,KACjBN,EAAU,MAAQ,EAAA,CACnB,EACA,MAAM,IAAMF,EAAO,KAAK,GAAG,CAAC,CAAA,EAGjCS,EAAUJ,CAAO,EAEjB,MAAMK,EAAQC,IACRC,EAAYC,EAChB,IACEH,EAAM,MAAM,KAAK,MACjBN,EAAI,OACJM,EAAM,MAAM,KAAK,KAAK,eAAe,SAASN,EAAI,MAAM,EAAE,CAAA,EAGxDU,EAAqB,IAAM,CAC3B,CAACV,EAAI,OACCW,EAAAX,EAAI,MAAM,GAAI,CAACQ,EAAU,KAAK,EAAE,KAAK,IAAM,CAC7CF,EAAA,SAASM,EAAgB,kBAAkB,CAAA,CAClD,CAAA,EAGGC,EAAiB,IAAM,CACvB,CAACb,EAAI,OACEc,EAAAd,EAAI,MAAM,GAAI,CAAE,SAAU,GAAM,EAAE,KAAKC,CAAO,CAAA,EAGrDc,EAAmBC,GAChBA,EAAK,mBAAmB,KAAM,CACnC,IAAK,UACL,MAAO,OACP,KAAM,UACN,OAAQ,SAAA,CACT"}